<!DOCTYPE html>
<html>
<head>
  <title>Signing you in…</title>
</head>
<body>
  <p>Completing login…</p>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7"></script>
  <script>
    const SUPABASE_URL = "https://REAL_PROJECT_ID.supabase.co";
    const SUPABASE_ANON_KEY = "REAL_PUBLIC_ANON_KEY";

    const supabase = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY
    );

    (async () => {
      // Supabase parses the OAuth session from URL automatically
      const { data: { session } } = await supabase.auth.getSession();

      if (!session) {
        document.body.innerText = "Login failed";
        return;
      }

      // Call backend to finalize setup
      await fetch('/api/auth/google/complete', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${session.access_token}`
        }
      });

      // Redirect to app dashboard
      window.location.href = '/';
    })();
  </script>
</body>
</html>
